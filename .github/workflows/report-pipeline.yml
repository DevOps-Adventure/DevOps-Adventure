name: Compile LATEX Report Pipeline

on:
  push:

jobs: 
  build_latex:
    permissions:
      contents: write
    runs-on: ubuntu-latest
    steps:
      - name: Set up Git repository
        uses: actions/checkout@v4

      - name: Checkout report branch
        run: git checkout report

      - name: Compile LaTeX document
        uses: xu-cheng/latex-action@v3
        with:
          root_file: main.tex
          working_directory: report/

      # - name: Upload PDF file
      #   uses: actions/upload-artifact@v4
      #   with:
      #     name: PDF
      #     path: main.pdf

      # - name: Download PDF file
      #   uses: actions/download-artifact@v4
      #   with:
      #     name: PDF
      #     path: report/
      
      - name: Status
        run: git status

      - name: Add pdf file to version control
        run: git add .

      # - name: Delete old report generated by Latex compiler
      #   run: |
      #     ls
      #     rm report/build/Msc_group_g.pdf
      
      - name: Move pdf to build folder
        run: git mv report/main.pdf report/build/Msc_group_g.pdf

      - name: Delete artifacts generated by Latex compiler
        run: |
          rm report/main.aux
          rm report/main.fdb_latexmk
          rm report/main.fls
          rm report/main.log
          rm report/main.toc

      - name: Push compiled report to repo
        run: |
          git config --global user.email "babkinedicapriotomas@gmail.com"
          git config --global user.name "Tomas Babkine-Di Caprio"
          git checkout report
          git add .
          git commit -m "feat: add rendered latex"
          git push origin ${{ github.ref }}